!function(){"use strict";function t(e,t){this.element=e,this.options=c.extend({},i,t),this._defaults=i,this._name=o,this.init()}var c,p,d,s,o,i;!function i(n,s,a){function r(t,e){if(!s[t]){if(!n[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(l)return l(t,!0);throw(o=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",o}o=s[t]={exports:{}},n[t][0].call(o.exports,function(e){return r(n[t][1][e]||e)},o,o.exports,i,n,s,a)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)r(a[e]);return r}({1:[function(e,t,o){var i,n=e("./src/valid-form"),e=(i=n)&&i.__esModule?i:{default:i};window.ValidForm=e.default,window.ValidForm.toggleInvalidClass=n.toggleInvalidClass,window.ValidForm.handleCustomMessages=n.handleCustomMessages,window.ValidForm.handleCustomMessageDisplay=n.handleCustomMessageDisplay},{"./src/valid-form":3}],2:[function(e,t,o){function i(e){var t,o={};for(t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o}Object.defineProperty(o,"__esModule",{value:!0}),o.clone=i,o.defaults=function(e,t){for(var o in e=i(e||{}),t)void 0===e[o]&&(e[o]=t[o]);return e},o.insertAfter=function(e,t){var o=e.nextSibling;o?e.parentNode.insertBefore(t,o):parent.appendChild(t)},o.insertBefore=function(e,t){e.parentNode.insertBefore(t,e)},o.forEach=function(e,t){if(e)if(e.forEach)e.forEach(t);else for(var o=0;o<e.length;o++)t(e[o],o,e)},o.debounce=function(e,t){var o=void 0;return function(){clearTimeout(o),o=setTimeout(t,e)}}},{}],3:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.toggleInvalidClass=n,o.handleCustomMessages=s,o.handleCustomMessageDisplay=l,o.default=function(e,t){if(!e||!e.nodeName)throw new Error("First arg to validForm must be a form, input, select, or textarea");var o=void 0,i=e.nodeName.toLowerCase();if(t=(0,r.defaults)(t,c),"form"===i)o=e.querySelectorAll("input, select, textarea"),function(t,e){var o=(0,r.debounce)(100,function(){var e=t.querySelector(":invalid");e&&e.focus()});(0,r.forEach)(e,function(e){return e.addEventListener("invalid",o)})}(e,o);else{if("input"!==i&&"select"!==i&&"textarea"!==i)throw new Error("Only form, input, select, or textarea elements are supported");o=[e]}!function(e,t){var o=t.invalidClass,i=t.customMessages;(0,r.forEach)(e,function(e){n(e,o),s(e,i),l(e,t)})}(o,t)};var r=e("./util");function n(e,t){e.addEventListener("invalid",function(){e.classList.add(t)}),e.addEventListener("input",function(){e.validity.valid&&e.classList.remove(t)})}var a=["badInput","patternMismatch","rangeOverflow","rangeUnderflow","stepMismatch","tooLong","tooShort","typeMismatch","valueMissing","customError"];function s(t,o){function e(){var e=t.validity.valid?null:function(e,t){t=t||{};for(var o=[e.type+"Mismatch"].concat(a),i=e.validity,n=0;n<o.length;n++){var s=o[n];if(i[s])return e.getAttribute("data-"+s)||t[s]}}(t,o);t.setCustomValidity(e||"")}t.addEventListener("input",e),t.addEventListener("invalid",e)}function l(i,e){var n=e.validationErrorClass,s=e.validationErrorParentClass,a=e.errorPlacement;function t(e){var t=e.insertError,o=i.parentNode,e=o.querySelector("."+n)||document.createElement("div");!i.validity.valid&&i.validationMessage?(e.className=n,e.textContent=i.validationMessage,t&&(("before"===a?(0,r.insertBefore):(0,r.insertAfter))(i,e),o.classList.add(s))):(o.classList.remove(s),e.remove())}i.addEventListener("input",function(){t({insertError:!1})}),i.addEventListener("invalid",function(e){e.preventDefault(),t({insertError:!0})})}var c={invalidClass:"invalid",validationErrorClass:"validation-error",validationErrorParentClass:"has-validation-error",customMessages:{},errorPlacement:"before"}},{"./util":2}]},{},[1]),c=jQuery,p=window,d=document,i={debug:!(o="minnpost_giving"),stripe_publishable_key:"",plaid_env:"",plaid_link:"#authorize-ach",minnpost_root:"https://www.minnpost.com",analytics_type:"",progress_selector:".m-support-progress",form_selector:".m-form",donate_form_selector:"#donate",confirm_form_selector:"#confirm",finish_section_selector:"#panel--confirmation",pay_cc_processing_selector:'input[name="pay_fees"]',fee_amount:".processing-amount",level_amount_selector:"#panel--pay .amount .level-amount",original_amount_selector:'[name="amount"]',gift_delivery_method_selector:'[name="gift_delivery_method"]',fair_market_value_selector:"#fair_market_value",full_amount_selector:".full-amount",installment_period_selector:'[name="installment_period"]',name_selector:".m-form-item-display-name",in_honor_or_memory_field_selector:".m-form-item-honor-memory",honor_or_memory_chooser:'input[name="in_honor_or_memory"]',honor_type_selector:".a-honor-type",honor_memory_input_group:".a-honor-or-memory",anonymous_selector:"#anonymous",show_billing_country_selector:"#billing_show_country",billing_country_selector:".m-form-item-country",show_shipping_country_selector:"#shipping_show_country",shipping_country_selector:".m-form-item-shipping-country",shipping_address_selector:".m-form-item-shipping-address",use_for_shipping_selector:"#useforshipping",email_field_selector:"#email",password_field_selector:"#password",first_name_field_selector:"#first_name",last_name_field_selector:"#last_name",billing_street_field_selector:"#billing_street",billing_city_field_selector:"#billing_city",billing_state_field_selector:"#billing_state",billing_zip_field_selector:"#billing_zip",billing_country_field_selector:"#billing_country",shipping_state_field_selector:"#shipping_state",shipping_zip_field_selector:"#shipping_zip",shipping_country_field_selector:"#shipping_country",create_mp_selector:"#creatempaccount",password_selector:".m-form-item-password",additional_amount_field:"#additional_donation",shipping_amount_field:'[name="shipping_cost"]',shipping_selector:"fieldset.m-shipping-information",choose_payment:"#choose-payment-method",payment_method_selector:".payment-method",cc_num_selector:"#card-number",cc_exp_selector:"#card-expiry",cc_cvc_selector:"#card-cvc",pay_button_selector:".a-button-pay",opp_id_selector:"#lock_key",newsletter_group_selector:".support-newsletters"},t.prototype={init:function(e,t){d.documentElement.classList.remove("no-js"),d.documentElement.classList.add("js"),this.options.amount=!0!==e?parseFloat(c(this.options.level_amount_selector,this.element).text()):t,this.options.original_amount=parseInt(c(this.options.original_amount_selector,this.element).val(),10),this.options.processing_fee=(Math.round(parseFloat(this.options.fee_amount)*Math.pow(10,2))/Math.pow(10,2)).toFixed(2),this.options.processing_fee_text=this.options.processing_fee,this.options.create_account=!1;t=c(this.options.pay_button_selector).text();this.options.button_text=t,this.stripe=Stripe(this.options.stripe_publishable_key),this.elements=this.stripe.elements({fonts:[{cssSrc:"https://use.typekit.net/cxj7fzg.css"}]}),!0===this.options.debug&&this.debug(this.options),this.analyticsTracking(this.options),this.amountAsRadio(this.element,this.options),this.amountUpdated(this.element,this.options),0<c(this.options.pay_cc_processing_selector).length&&this.creditCardProcessingFees(this.options),0<c(this.options.donate_form_selector).length&&(this.donateAnonymously(this.element,this.options),this.honorOrMemoryToggle(this.element,this.options),this.outsideUnitedStates(this.element,this.options),this.shippingAddress(this.element,this.options),this.allowMinnpostAccount(this.element,this.options),this.paymentRequestButton(this.element,this.options),this.choosePaymentMethod(this.element,this.options),this.creditCardFields(this.element,this.options),this.validateSetup(this.element,this.options),this.formSetup(this.element,this.options)),0<c(this.options.confirm_form_selector).length&&(this.showNewsletterSettings(this.element,this.options),this.confirmMessageSubmit(this.element,this.options))},debug:function(e){!0===this.options.debug&&("object"!=typeof e?console.log(e):console.dir(e),console.dir(this))},analyticsTracking:function(e){this.debug("analytics type is "+e.analytics_type);var t,o=c(e.progress_selector),i="begin_checkout",n=0,s=c(e.opp_id_selector).val(),a=!1;if("analyticsjs"==e.analytics_type&&ga("require","ec"),0<o.length&&(n=c("li",o).length,t=c("li .active",o).parent().index()+1),0<o.length&&0===c(e.confirm_form_selector).length)t===n&&0===c(e.confirm_form_selector).length&&(t+=1,a=!0);else if(0<o.length&&0<c(e.confirm_form_selector).length||0<c(e.finish_section_selector).length)i="purchase";else if(0===o.length)return;this.debug("step is "+t+" and nav item count is "+n+" and opp id is "+s+" and post purchase is "+a),this.analyticsTrackingStep(t,i,a)},analyticsTrackingStep:function(t,o,e){var i,n=c(this.options.progress_selector),s=c(this.options.original_amount_selector).val(),a=c(this.options.opp_id_selector).val(),r="one-time",l=this;0<c(this.options.installment_period_selector).length&&(r=c(this.options.installment_period_selector).val()),0<n.length&&(n={amount:s,installment_period:r},c.ajax({method:"POST",url:"/calculate-member-level/",data:n}).done(function(e){0<c(e.level).length&&(i=e.level.level,l.debug("create product object: id is minnpost_"+i.toLowerCase()+"_membership and name is MinnPost "+i.charAt(0).toUpperCase()+i.slice(1)+" Membership and variant is "+r.charAt(0).toUpperCase()+r.slice(1)),e={id:"minnpost_"+i.toLowerCase()+"_membership",name:"MinnPost "+i.charAt(0).toUpperCase()+i.slice(1)+" Membership",category:"Donation",brand:"MinnPost",variant:r.charAt(0).toUpperCase()+r.slice(1),price:l.getTotalAmount(s),quantity:1},"gtagjs"==l.options.analytics_type?gtag("event","checkout_progress",{value:l.getTotalAmount(s),items:[e],checkout_step:t,checkout_option:o}):"analyticsjs"==l.options.analytics_type&&(ga("ec:addProduct",e),ga("ec:setAction","checkout",{step:t,option:o})),"purchase"===o&&(l.debug("add a purchase action. step is "+t+" and action is "+o),"gtagjs"==l.options.analytics_type?gtag("event",o,{transaction_id:a,affiliation:"MinnPost",value:l.getTotalAmount(s),currency:"USD",items:[e],checkout_step:t}):"analyticsjs"==l.options.analytics_type&&ga("ec:setAction",o,{id:a,affiliation:"MinnPost",revenue:s,step:t})),"gtagjs"==l.options.analytics_type?gtag("event","page_view",{page_title:d.title,page_path:p.location.pathname}):"analyticsjs"==l.options.analytics_type&&(ga("set",{page:p.location.pathname,title:d.title}),ga("send","pageview",p.location.pathname)),"undefined"!=typeof dataLayer&&(dataLayer.push({ecommerce:null}),dataLayer.push({event:o,ecommerce:{items:e}})))}))},amountAsRadio:function(e,t){var o=this;o.setRadioAmount(c(t.original_amount_selector,e),e,t),c(t.original_amount_selector,e).change(function(){o.setRadioAmount(c(this),e,t)})},setRadioAmount:function(e,t,o){var i=this.getStripePaymentType(),t=c(o.original_amount_selector+":checked",t).val();e.is(":radio")&&void 0!==t&&(o.original_amount=parseInt(t,10),this.calculateFees(this.options.original_amount,i),this.setFairMarketValue(e))},amountUpdated:function(e,t){var o=this,i=o.getStripePaymentType(),n=c(t.original_amount_selector,e);n.is(":radio")&&(n=c(t.original_amount_selector+":checked",e)),o.setFairMarketValue(n),c(t.original_amount_selector,e).change(function(){o.options.original_amount=parseInt(c(this,e).val(),10),o.calculateFees(o.options.original_amount,i),o.setFairMarketValue(c(this,e))}),c(t.additional_amount_field,e).change(function(){o.options.original_amount=parseInt(c(t.original_amount_selector,e).val(),10),o.calculateFees(o.options.original_amount,i)}),c(t.gift_delivery_method_selector,e).change(function(){o.options.original_amount=parseInt(c(t.original_amount_selector,e).val(),10),o.calculateFees(o.options.original_amount,i)})},getTotalAmount:function(e){var t,o=e=void 0!==e?e:this.options.original_amount;return 0<c(this.options.additional_amount_field).length&&0<c(this.options.additional_amount_field).val()&&(t=c(this.options.additional_amount_field).val(),o=parseInt(t,10)+parseInt(e,10)),0<c(this.options.shipping_amount_field).length&&0<c(this.options.shipping_amount_field).val()&&(e=c(this.options.shipping_amount_field).val(),o="shipping"===c(this.options.gift_delivery_method_selector+":checked").val()?parseInt(e,10)+parseInt(o,10):parseInt(o,10)),o},setFairMarketValue:function(e){0<c(this.options.fair_market_value_selector).length&&void 0!==e.data("fair-market-value")&&(e=e.data("fair-market-value"),c(this.options.fair_market_value_selector).val(e))},calculateFees:function(e,t){var o=this,e={amount:o.getTotalAmount(e),stripe_payment_type:t};o.setStripePaymentType(t),c.ajax({method:"POST",url:"/calculate-fees/",data:e}).done(function(e){0<c(e.fees).length&&(c(o.options.fee_amount).text(parseFloat(e.fees).toFixed(2)),o.creditCardFeeCheckbox(c(o.options.pay_cc_processing_selector)))})},creditCardProcessingFees:function(e){var t=this;t.creditCardFeeCheckbox(c(e.pay_cc_processing_selector)),c(e.pay_cc_processing_selector).on("change",function(){t.creditCardFeeCheckbox(this)})},getStripePaymentType:function(){var e="card";return e=0<c('input[name="stripe_payment_type"]').length?c('input[name="stripe_payment_type"]').val():e},setStripePaymentType:function(e){return 0===c('input[name="stripe_payment_type"]').length&&c(this.options.donate_form_selector).append('<input type="hidden" name="stripe_payment_type">'),c('input[name="stripe_payment_type"]').val(e),e},creditCardFeeCheckbox:function(e){var t=this.getTotalAmount(),t=c(e).is(":checked")||c(e).prop("checked")?(c(".amount .level-amount").addClass("full-amount"),t+parseFloat(c(this.options.fee_amount).text())):t;t=parseFloat(t).toFixed(2),c(this.options.full_amount_selector).text(t),this.paymentRequest&&t&&this.paymentRequest.update({total:{label:"MinnPost",amount:100*t}})},donateAnonymously:function(e,t){var o=this;o.toggleAnonymous(c(t.anonymous_selector,e)),c(t.anonymous_selector,e).change(function(){o.toggleAnonymous(c(this))})},toggleAnonymous:function(e){e.is(":checked")?c(this.options.name_selector+" div:first",this.element).hide():c(this.options.name_selector+" div:first",this.element).show()},honorOrMemory:function(e,t){c(t.honor_or_memory_chooser+":checked").val()?(c(t.honor_memory_input_group,e).show(),c(t.honor_type_selector).text(c(t.honor_or_memory_chooser+":checked").val())):(c(t.honor_memory_input_group,e).hide(),c(t.honor_name_selector+" input",e).val(""))},honorOrMemoryToggle:function(e,t){var o=this;o.honorOrMemory(o.element,o.options),c(t.honor_or_memory_chooser,e).change(function(){o.honorOrMemory(o.element,o.options)})},outsideUnitedStates:function(e,t){var o=this;c(t.show_billing_country_selector).click(function(){return o.changeFieldsOutsideUS("billing",e,t),c(this).parent().hide(),!1}),c(t.show_shipping_country_selector).click(function(){return c(t.shipping_country_selector).show(),o.changeFieldsOutsideUS("shipping",e,t),c(this).parent().hide(),!1})},changeFieldsOutsideUS:function(e,t,o){var i,n;"billing"===e?(i=c(o.billing_zip_field_selector,t).parent(),n=c(o.billing_state_field_selector,t).parent(),c(o.billing_country_selector).show(),c(o.billing_zip_field_selector,t).attr("type","text"),c(o.billing_zip_field_selector,t).prop("required",!1),c(o.billing_state_field_selector,t).prop("required",!1),c("label",i).text("Postal Code:"),c("label",n).text("Region:")):"shipping"===e&&(i=c(o.shipping_zip_field_selector,t).parent(),n=c(o.shipping_state_field_selector,t).parent(),c(o.shipping_country_selector).show(),c(o.shipping_zip_field_selector,t).attr("type","text"),c(o.shipping_zip_field_selector,t).prop("required",!1),c(o.shipping_state_field_selector,t).prop("required",!1),c("label",i).text("Shipping Postal Code:"),c("label",n).text("Shipping Region:"))},changeFieldsInsideUS:function(e,t,o){var i,n;"billing"===e?(i=c(o.billing_zip_field_selector,t).parent(),n=c(o.billing_state_field_selector,t).parent(),c(o.billing_country_selector).show(),c(o.billing_zip_field_selector,t).attr("type","tel"),c(o.billing_zip_field_selector,t).prop("required",!0),c(o.billing_state_field_selector,t).prop("required",!0),c("label",i).html('Zip Code: <span class="a-form-item-required" title="This field is required.">*</span>'),c("label",n).html('State: <span class="a-form-item-required" title="This field is required.">*</span>')):"shipping"===e&&(i=c(o.shipping_zip_field_selector,t).parent(),n=c(o.shipping_state_field_selector,t).parent(),c(o.shipping_country_selector).show(),c(o.shipping_zip_field_selector,t).attr("type","tel"),c(o.shipping_zip_field_selector,t).prop("required",!0),c(o.shipping_state_field_selector,t).prop("required",!0),c("label",i).html('Shipping Zip Code: <span class="a-form-item-required" title="This field is required.">*</span>'),c("label",n).html('Shipping State: <span class="a-form-item-required" title="This field is required.">*</span>'))},shippingAddress:function(e,t){var o=this,i=!1;!0===(i=0<c(t.use_for_shipping_selector).length?!0:i)&&(c(t.use_for_shipping_selector,e).parent().show(),c(t.use_for_shipping_selector,e).is(":checked")?c(t.shipping_selector).hide():c(t.shipping_selector).show(),c(t.use_for_shipping_selector,e).change(function(){o.shippingAddress(e,t)}))},allowMinnpostAccount:function(t,o){var e,i=this;function n(){var e=c(o.email_field_selector,t).val();i.checkMinnpostAccount(t,o,e)}i.showPassword(),i.showPasswordStrength(),i.spamEmail(c(o.email_field_selector,t)),c(o.email_field_selector,t).change(function(){i.spamEmail(c(o.email_field_selector,t))}),i.toggleAccountFields(c(o.create_mp_selector,t)),c(o.create_mp_selector,t).change(function(){i.toggleAccountFields(c(o.create_mp_selector,t))});c(o.email_field_selector,t).keyup(function(){clearTimeout(e),c(o.email_field_selector,t).val&&(e=setTimeout(n,5e3))})},spamEmail:function(e){e=e.parent();0===c(".a-spam-email",e).length&&e.append('<p class="a-form-caption a-validation-error a-spam-email">This email address has been detected as a spammer.</p>'),c(".a-spam-email",e).hide(),e.removeClass("invalid a-error")},toggleAccountFields:function(e){e.is(":checked")?(e.parent().before('<p class="a-form-caption a-account-exists a-account-exists-success">There is already a MinnPost.com account with this email address.</p>'),c(".a-account-exists").hide(),c(this.options.password_selector,this.element).show(),this.options.create_account=!0):c(this.options.password_selector,this.element).hide()},showPassword:function(){var e=c(".btn-submit"),t=c(this.options.password_selector,this.element),o=c('input[name="password"]',t);c(".a-account-exists").hide();t.append('<div class="a-form-show-password a-form-caption"><label><input type="checkbox" name="show_password" id="show-password-checkbox" value="1"> Show password</label></div>'),c("#show-password-checkbox").on("click",function(e){c(this).is(":checked")?o.attr("type","text"):o.attr("type","password")}),e.on("click",function(e){o.attr("type","password")})},showPasswordStrength:function(){var e=this;0<c(".a-password-strength").length&&(c(".a-form-show-password").after(c('<div class="a-password-strength"><meter max="4" id="password-strength"><div></div></meter><p class="a-form-caption" id="password-strength-text"></p></div>')),c("body").on("keyup","input[name=password]",function(){e.checkPasswordStrength(c("input[name=password]"),c("#password-strength"),c("#password-strength-text"))}))},checkPasswordStrength:function(e,t,o){e=e.val(),e=zxcvbn(e).score;switch(o.removeClass("short bad good strong"),e){case 2:o.addClass("bad").html("Strength: <strong>Weak</strong>");break;case 3:o.addClass("good").html("Strength: <strong>Medium</strong>");break;case 4:o.addClass("strong").html("Strength: <strong>Strong</strong>");break;default:o.addClass("short").html("Strength: <strong>Very weak</strong>")}return t.val(e),e},checkMinnpostAccount:function(t,o,e){var i=this;c.ajax({method:"GET",url:o.minnpost_root+"/wp-json/user-account-management/v1/check-account",data:{email:e}}).done(function(e){if("success"===e.status&&"user exists"===e.reason)c(o.create_mp_selector,t).is(":checked")&&(c(o.password_selector,t).hide(),c(o.create_mp_selector,t).parent().hide(),c(".a-account-exists",t).show()),c(o.create_mp_selector,t).on("change",function(){c(o.create_mp_selector,t).is(":checked")&&(c(o.password_selector,t).hide(),c(o.create_mp_selector,t).parent().hide(),c(".a-account-exists",t).show())});else{if("spam"!==e.status)return c(o.create_mp_selector,t).is(":checked")?(c(o.password_selector,t).show(),o.create_account=!0):c(o.password_selector,t).hide(),c(".a-account-exists",t).hide(),!1;c(i.options.email_field_selector).addClass("invalid a-error"),c(".a-spam-email").show()}})},paymentRequestButton:function(e,t){var n=this,o=n.getTotalAmount();n.paymentRequest=n.stripe.paymentRequest({country:"US",currency:"usd",total:{label:"MinnPost",amount:100*o}}),n.prButton=n.elements.create("paymentRequestButton",{paymentRequest:n.paymentRequest,style:{paymentRequestButton:{type:"donate",theme:"dark",height:"48px"}}}),n.paymentRequest.canMakePayment().then(function(e){e?(c(".m-pay-without-payment-request").hide(),n.prButton.mount("#payment-request-button")):n.hidePaymentRequest(c(".o-pay-with-payment-request"))}),c(".decline-apple-pay a").click(function(e){e.preventDefault(),n.hidePaymentRequest(c(".o-pay-with-payment-request .m-form-actions-pay-fees"))}),n.prButton.on("click",function(e){c(n.options.donate_form_selector).get(0).reportValidity()||e.preventDefault()}),n.paymentRequest.on("paymentmethod",function(e){var t=c(n.options.donate_form_selector),o="payment_method_id",i='input[name="'+o+'"]';0<c(i).length?c(i).val(e.paymentMethod.id):t.append(c('<input type="hidden" name="'+o+'">').val(e.paymentMethod.id)),n.formProcessor(n,"paymentRequest")})},hidePaymentRequest:function(e){e.hide(),c(".decline-apple-pay a").hide(),c(".m-pay-without-payment-request").show(),c(".a-g-recaptcha").insertAfter(".m-pay-without-payment-request .m-form-actions-pay-fees")},choosePaymentMethod:function(e,t){var o,i,n=this;0<c(t.choose_payment).length&&(c(t.choose_payment+" input").is(":checked")&&(o=c(t.choose_payment+" input:checked").attr("id"),i=c(t.choose_payment+" input:checked").val(),n.setupPaymentMethod(o,i)),c(t.choose_payment+" input").change(function(){var e=this.id,t=this.value;n.setupPaymentMethod(e,t)}))},setupPaymentMethod:function(e,t){var o=this.setStripePaymentType(t);"bank_account"===t?(c('input[name="payment_method_id"]',c(this.options.donate_form_selector)).remove(),this.achFields(this.element,this.options)):this.removeAchFields(this.options),c(this.options.payment_method_selector).removeClass("active"),c(this.options.payment_method_selector+"."+e).addClass("active"),c(this.options.payment_method_selector+":not(.active) input").val(""),this.calculateFees(this.options.original_amount,o)},removeAchFields:function(e){c('input[name="public_token"]',c(e.donate_form_selector)).remove(),c('input[name="account_id"]',c(e.donate_form_selector)).remove(),c('input[name="bankToken"]',c(e.donate_form_selector)).remove(),c(e.plaid_link).html('<a href="#">Sign in to your bank account</a>'),this.buttonDisabled(e,!1,"","",!0),void 0!==this.linkHandler&&this.linkHandler.destroy()},creditCardFields:function(o,i){var n=this,e={base:{iconColor:"#666EE8",lineHeight:"43px",fontWeight:400,fontFamily:"ff-meta-web-pro",fontSize:"24px"},invalid:{color:"#1a1818"}};0===c(".credit-card-group").length&&0===c(".payment-method.choose-card").length||(n.cardNumberElement=n.elements.create("cardNumber",{showIcon:!0,style:e}),n.cardNumberElement.mount(i.cc_num_selector),n.cardExpiryElement=n.elements.create("cardExpiry",{style:e}),n.cardExpiryElement.mount(i.cc_exp_selector),n.cardCvcElement=n.elements.create("cardCvc",{style:e}),n.cardCvcElement.mount(i.cc_cvc_selector),n.cardNumberElement.on("change",function(e){var t="card";e.brand&&"amex"===e.brand&&(t="amex"),n.stripeErrorDisplay(e.error,c(i.cc_num_selector,o),o,i),n.buttonStatus(i,c(n.options.donate_form_selector).find("button"),!1),n.calculateFees(n.options.original_amount,t)}),n.cardExpiryElement.on("change",function(e){n.stripeErrorDisplay(e.error,c(i.cc_exp_selector,o),o,i),n.buttonStatus(i,c(n.options.donate_form_selector).find("button"),!1)}),n.cardCvcElement.on("change",function(e){n.stripeErrorDisplay(e.error,c(i.cc_cvc_selector,o),o,i),n.buttonStatus(i,c(n.options.donate_form_selector).find("button"),!1)}))},showSpinner:function(){c(this.options.plaid_link).hide(),c(this.options.plaid_link).after('<div class="a-spinner"><img src="https://www.minnpost.com/wp-admin/images/spinner.gif" srcset="https://www.minnpost.com/wp-admin/images/spinner.gif 1x, https://www.minnpost.com/wp-admin/images/spinner-2x.gif 2x,"></div>')},hideSpinner:function(){c(this.options.plaid_link).show(),c(".a-spinner").hide()},achFields:function(o,i){var n="bankToken",s='input[name="'+n+'"]',a=this;a.buttonDisabled(i,!0,"","Sign in to your bank account (above) first"),"undefined"!=typeof Plaid&&(a.linkHandler=Plaid.create({clientName:"MinnPost",env:i.plaid_env,product:["auth"],token:d.getElementById("plaid_link_token").value,onSuccess:function(e,t){a.showSpinner(),c.ajax({url:"/get_plaid_access_token/",data:JSON.stringify({public_token:e,account_id:t.account_id}),type:"POST",contentType:"application/json; charset=utf-8"}).done(function(e){void 0!==e.error?(a.hideSpinner(),c(i.plaid_link).before('<p class="a-error a-validation-error">'+e.error+"</p>")):(0<c(s).length?c(s).val(e.stripe_bank_account_token):c(i.donate_form_selector).prepend(c('<input type="hidden" name="'+n+'">').val(e.stripe_bank_account_token)),c(i.plaid_link,o).html("<strong>Your account was successfully authorized</strong>"),a.hideSpinner(),a.buttonDisabled(i,!1))}).fail(function(e){a.debug(e),a.hideSpinner(),c(i.plaid_link).before('<p class="a-error a-validation-error">'+e.error+"</p>")})}}),c(i.plaid_link+" a").click(function(e){e.preventDefault(),a.resetFormErrors(a.options,a.element),a.linkHandler.open()}))},buttonStatus:function(e,t,o){this.buttonDisabled(e,o,t),!1===o?t.text(e.button_text):t.text("Processing")},buttonDisabled:function(e,t){let o=2<arguments.length&&arguments[2]!==s?arguments[2]:"";var i=3<arguments.length&&arguments[3]!==s?arguments[3]:"",n=4<arguments.length&&arguments[4]!==s&&arguments[4];""===o&&(o=c(e.donate_form_selector).find("button")),o.prop("disabled",t),"undefined"!=typeof tlite&&(""!==i?(!0===t?o.attr("data-tlite",i):o.removeAttr("data-tlite"),o.on("mouseenter focus",function(e){tlite.show(this,{grav:"nw"})}),o.on("mouseleave",function(e){tlite.hide(this)})):(o.removeAttr("data-tlite"),!0===n&&(o.on("mouseenter focus",function(e){tlite.hide(this)}),o.click(function(e){return!0}))))},validateSetup:function(e,t){d.querySelectorAll(t.form_selector).forEach(function(e){ValidForm(e,{validationErrorParentClass:"m-has-validation-error",validationErrorClass:"a-validation-error",invalidClass:"a-error",errorPlacement:"after"})}),this.scrollToFormError(t)},scrollToFormError:function(e){var i=c(e.form_selector);i.find(":input").on("invalid",function(){var e=c(this),t=i.find(".a-error").first(),o=t.parent();if(e[0]===t[0]){t=o.offset().top,o=p.pageYOffset;if(o<t&&t<o+p.innerHeight)return!0;c("html, body").scrollTop(t)}})},formSetup:function(e,t){var o=this;c(t.donate_form_selector).submit(function(e){e.preventDefault(),o.formProcessor(o,"submit")})},formProcessor:function(e,t){e.resetFormErrors(e.options,e.element),"submit"===t&&e.buttonStatus(e.options,c(e.options.donate_form_selector).find("button"),!0);var o=e.generateBillingDetails();e.createMinnPostAccount(e.options,e.element),"submit"===t?"bank_account"!==c('input[name="stripe_payment_type"]').val()?e.createPaymentMethod(e.cardNumberElement,o):e.bankTokenHandler(c('input[name="bankToken"]').val(),"bank_account"):e.submitFormOnly()},stripeErrorDisplay:function(e,t,o,i){var n=t.attr("id");c(".a-card-instruction."+n).removeClass("a-validation-error"),c(".a-card-instruction."+n).empty(),c(t).removeClass("a-error"),e?(0<c(".a-card-instruction."+n).length?c(".a-card-instruction."+n).text(e.message):t.parent().append('<p class="a-card-instruction '+n+'">'+e.message+"</p>"),c(".a-card-instruction."+n).addClass("a-validation-error"),t.parent().addClass("m-has-validation-error"),c(t).addClass("a-error"),0<t.parent().length&&c("html, body").animate({scrollTop:t.parent().offset().top},2e3)):(c(t).removeClass("a-error"),c(".a-card-instruction."+n).removeClass("a-validation-error"),c(".a-card-instruction."+n).empty(),c(i.cc_num_selector,o).removeClass("a-validation-error"),c(i.cc_exp_selector,o).removeClass("a-validation-error"),c(i.cc_cvc_selector,o).removeClass("a-validation-error"),c(i.cc_num_selector,o).parent().removeClass("m-has-validation-error"),c(i.cc_exp_selector,o).parent().removeClass("m-has-validation-error"),c(i.cc_cvc_selector,o).parent().removeClass("m-has-validation-error"))},resetFormErrors:function(e,t){var o=this;c(".a-validation-error").remove(),c("input, label, div",t).removeClass("a-error"),c("label",t).removeClass("m-has-validation-error"),c(e.payment_method_selector,t).removeClass("a-error invalid"),c(".a-validation-error").remove(),c(e.choose_payment+" input").change(function(){c(e.payment_method_selector+" .a-error").remove(),c(e.payment_method_selector).parent().find(".a-validation-error").remove(),o.buttonStatus(e,c(e.donate_form_selector).find("button"),!1)})},createMinnPostAccount:function(e,t){!0===e.create_account&&(t={email:c(e.email_field_selector,t).val(),first_name:c(e.first_name_field_selector,t).val(),last_name:c(e.last_name_field_selector,t).val(),password:c(e.password_field_selector,t).val(),city:c(e.billing_city_field_selector,t).val(),state:c(e.billing_state_field_selector,t).val(),zip:c(e.billing_zip_field_selector,t).val()},c.ajax({method:"POST",url:e.minnpost_root+"/wp-json/user-account-management/v1/create-user",data:t}).done(function(e){"success"===e.status&&e.reason}))},generateBillingDetails:function(){var e={},t={};""!=c(this.options.email_field_selector).val()&&(e.email=c(this.options.email_field_selector).val());var o="",o=0<c("#full_name").length?c("#full_name").val():c(this.options.first_name_field_selector).val()+" "+c(this.options.last_name_field_selector).val();e.name=o;var i="None";""!=c(this.options.billing_street_field_selector).val()&&(i=c(this.options.billing_street_field_selector).val(),t.line1=i);var n="None";""!=c(this.options.billing_city_field_selector).val()&&(n=c(this.options.billing_city_field_selector).val(),t.city=n);var s="None";""!=c(this.options.billing_state_field_selector).val()&&(s=c(this.options.billing_state_field_selector).val(),t.state=s);var a="None";""!=c(this.options.billing_zip_field_selector).val()&&(a=c(this.options.billing_zip_field_selector).val(),t.postal_code=a);var r="US",o=c(this.options.billing_country_field_selector).val();return t.country=r=""!=o&&"United States"!=o?o:r,"None"===i&&"None"===n&&"None"===s&&"None"===a||(e.address=t),e},createPaymentMethod:function(e,t){var s=this;s.stripe.createPaymentMethod({type:"card",card:e,billing_details:t}).then(function(e){var t,o,i,n;e.error?s.handleServerError(e):(t=c(s.options.donate_form_selector),o=p.location.pathname,0<c(n='input[name="'+(i="payment_method_id")+'"]').length?c(n).val(e.paymentMethod.id):t.append(c('<input type="hidden" name="'+i+'">').val(e.paymentMethod.id)),fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c(t).serialize()}).then(function(e){e.json().then(function(e){s.handleServerResponse(e)})}))})},bankTokenHandler:function(e,t){this.setStripePaymentType(t),this.submitFormOnly()},submitFormOnly:function(){var t=this,o=c(this.options.donate_form_selector),e=p.location.pathname;c.ajax({url:e,cache:!1,data:c(o).serialize(),type:"POST"}).done(function(e){void 0!==e.errors?t.handleServerError(e):o.get(0).submit()}).fail(function(){t.buttonStatus(t.options,c(t.options.donate_form_selector).find("button"),!1)})},handleServerResponse:function(e){var t=c(this.options.donate_form_selector);e.errors?this.handleServerError(e):e.requires_action||t.get(0).submit()},handleServerError:function(e){var o=this,i="";o.buttonStatus(o.options,c(o.options.donate_form_selector).find("button"),!1),void 0!==e.errors?(void 0!==e.errors[0]&&(i=e.errors[0].field+"_field_selector"),c.each(e.errors,function(e,t){void 0!==t.field?i=t.field+"_field_selector":void 0!==t.param&&""!==t.param&&(i="cc_"+t.param+"_selector"),o.displayErrorMessage(t,i)})):void 0!==e.error&&(void 0!==(e=e.error).field?i=e.field+"_field_selector":void 0!==e.param&&""!==e.param&&(i="cc_"+e.param+"_selector"),o.displayErrorMessage(e,i)),0<c(o.options[i]).length&&c("html, body").animate({scrollTop:c(o.options[i]).parent().offset().top},2e3)},displayErrorMessage(e,t){var o="",i="",n=c(this.options[t]).parent(),o="string"==typeof e.message?e.message:e.message[0];0<c(this.options[t]).length?(c(this.options[t]).addClass("a-error"),c(this.options[t]).prev().addClass("a-error"),0<c(".a-card-instruction",n).length?(c(".a-card-instruction",n).addClass("a-validation-error"),c(".a-card-instruction",n).text(o)):c(this.options[t]).after('<p class="a-card-instruction a-validation-error">'+o+"</p>")):void 0!==e&&(this.buttonStatus(this.options,c(this.options.donate_form_selector).find("button"),!1),"incomplete_number"!==e.code&&"invalid_number"!=e.code&&"incorrect_number"!=e.code&&"card_declined"!=e.code&&"processing_error"!=e.code||(i=c(this.options.cc_num_selector)),"invalid_expiry_month"!=e.code&&"invalid_expiry_year"!=e.code&&"expired_card"!=e.code||(i=c(this.options.cc_exp_selector)),"invalid_cvc"!=e.code&&"incorrect_cvc"!=e.code||(i=c(this.options.cc_cvc_selector)),""!==(i="email_invalid"==e.code?c(this.options.email_field_selector):i)&&this.stripeErrorDisplay(e,i,this.element,this.options),"missing_payment"==e.type&&""===i&&c(this.options.payment_method_selector+".active").append('<p class="a-form-caption a-validation-error a-missing-payment-error">'+e.message+"</p>"),"recaptcha"==e.field&&c(this.options.pay_button_selector).before('<p class="a-form-caption a-validation-error a-recaptcha-error">'+o+"</p>"),"invalid_request_error"==e.type&&""===i&&c(this.options.pay_button_selector).before('<p class="a-form-caption a-validation-error a-invalid-request-error">'+e.message+"</p>"))},showNewsletterSettings:function(t,o){var e,i="";0<c(o.newsletter_group_selector).length&&c.ajax({method:"GET",url:o.minnpost_root+"/wp-json/minnpost-api/v2/mailchimp/form",data:e={shortcode:"newsletter_form",placement:"useraccount"}}).done(function(e){void 0!==e.group_fields&&(c.each(e.group_fields,function(e,t){i+='<fieldset class="m-form-item support-newsletter m-form-item-'+t.type+'">',i+="<label>"+t.name+":</label>",0<t.contains.length&&(i+='<div class="m-form-item m-form-item-newsletter">',c.each(t[t.contains],function(e,t){i+='<label><input name="groups_submitted" type="checkbox" value="'+t.id+'">'+t.name+"</label>"}),i+="</div>"),i+="</fieldset>"}),c(o.newsletter_group_selector).html(i))}),0<c(o.newsletter_group_selector).length&&void 0!==c(o.email_field_selector,t).val()&&(e={email:c(o.email_field_selector,t).val()},c.ajax({method:"GET",url:o.minnpost_root+"/wp-json/minnpost-api/v2/mailchimp/user",data:e}).done(function(e){void 0!==e.mailchimp_status&&c(o.email_field_selector,t).after('<input name="mailchimp_status" type="hidden" value="'+e.mailchimp_status+'">'),void 0!==e.mailchimp_user_id&&c(o.email_field_selector,t).after('<input name="mailchimp_user_id" type="hidden" value="'+e.mailchimp_user_id+'">'),"subscribed"===e.mailchimp_status&&(c(".a-confirm-instructions").text(c(".a-confirm-instructions").attr("data-known-user")),e=e.groups,c.each(e,function(e,t){!0===t?c(':checkbox[value="'+e+'"]').prop("checked",!0):c(':checkbox[value="'+e+'"]').prop("checked",!1)}))}))},confirmMessageSubmit:function(n,s){var a=c(s.newsletter_group_selector+" input").serialize();c(s.confirm_form_selector).submit(function(e){e.preventDefault();var i,t=c(s.confirm_form_selector),o=c(s.newsletter_group_selector+" input:checked"),e=o.serialize();a!==e&&void 0!==o?(i={email:c(s.email_field_selector,n).val(),first_name:c(s.first_name_field_selector,n).val(),last_name:c(s.last_name_field_selector,n).val(),groups_submitted:{},groups_available:"all"},0<c('input[name="mailchimp_status"]').length&&(i.mailchimp_status=c('input[name="mailchimp_status"]').val()),0<c('input[name="mailchimp_user_id"]').length&&(i.mailchimp_user_id=c('input[name="mailchimp_user_id"]').val()),void 0!==o&&c.each(o,function(e,t){var o=c(this).val();i.groups_submitted[e]=o}),c.ajax({url:s.minnpost_root+"/wp-json/minnpost-api/v2/mailchimp/user",type:"post",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(i)}).done(function(e){e.success,t.get(0).submit()}).fail(function(e){t.get(0).submit()})):t.get(0).submit()})}},c.fn[o]=function(e){return this.each(function(){c.data(this,"plugin_"+o)||c.data(this,"plugin_"+o,new t(this,e))})}}(jQuery);