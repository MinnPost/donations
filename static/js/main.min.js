!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(b.payment||(b.payment={})).js=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d,e,f;d=function(a){return d.isDOMElement(a)?a:document.querySelectorAll(a)},d.isDOMElement=function(a){return a&&null!=a.nodeName},f=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,d.trim=function(a){return null===a?"":(a+"").replace(f,"")},e=/\r/g,d.val=function(a,b){var c;return arguments.length>1?a.value=b:(c=a.value,"string"==typeof c?c.replace(e,""):null===c?"":c)},d.preventDefault=function(a){return"function"==typeof a.preventDefault?void a.preventDefault():(a.returnValue=!1,!1)},d.normalizeEvent=function(a){var b;return b=a,a={which:null!=b.which?b.which:void 0,target:b.target||b.srcElement,preventDefault:function(){return d.preventDefault(b)},originalEvent:b,data:b.data||b.detail},null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a},d.on=function(a,b,c){var e,f,g,h,i,j,k,l;if(a.length)for(f=0,h=a.length;f<h;f++)e=a[f],d.on(e,b,c);else{if(!b.match(" "))return k=c,c=function(a){return a=d.normalizeEvent(a),k(a)},a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?(b="on"+b,a.attachEvent(b,c)):void(a["on"+b]=c);for(l=b.split(" "),g=0,i=l.length;g<i;g++)j=l[g],d.on(a,j,c)}},d.addClass=function(a,b){var c;return a.length?function(){var e,f,g;for(g=[],e=0,f=a.length;e<f;e++)c=a[e],g.push(d.addClass(c,b));return g}():a.classList?a.classList.add(b):a.className+=" "+b},d.hasClass=function(a,b){var c,e,f,g;if(a.length){for(e=!0,f=0,g=a.length;f<g;f++)c=a[f],e=e&&d.hasClass(c,b);return e}return a.classList?a.classList.contains(b):new RegExp("(^| )"+b+"( |$)","gi").test(a.className)},d.removeClass=function(a,b){var c,e,f,g,h,i;if(a.length)return function(){var c,f,g;for(g=[],c=0,f=a.length;c<f;c++)e=a[c],g.push(d.removeClass(e,b));return g}();if(a.classList){for(h=b.split(" "),i=[],f=0,g=h.length;f<g;f++)c=h[f],i.push(a.classList.remove(c));return i}return a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")},d.toggleClass=function(a,b,c){var e;return a.length?function(){var f,g,h;for(h=[],f=0,g=a.length;f<g;f++)e=a[f],h.push(d.toggleClass(e,b,c));return h}():c?d.hasClass(a,b)?void 0:d.addClass(a,b):d.removeClass(a,b)},d.append=function(a,b){var c;return a.length?function(){var e,f,g;for(g=[],e=0,f=a.length;e<f;e++)c=a[e],g.push(d.append(c,b));return g}():a.insertAdjacentHTML("beforeend",b)},d.find=function(a,b){return(a instanceof NodeList||a instanceof Array)&&(a=a[0]),a.querySelectorAll(b)},d.trigger=function(a,b,c){var d;try{d=new CustomEvent(b,{detail:c})}catch(a){a,d=document.createEvent("CustomEvent"),d.initCustomEvent?d.initCustomEvent(b,!0,!0,c):d.initEvent(b,!0,!0,c)}return a.dispatchEvent(d)},b.exports=d},{}],2:[function(a,b,c){(function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};e=a("qj/src/qj.coffee"),i=/(\d{1,4})/g,h=[{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[4],luhn:!0},{type:"dankort",pattern:/^5019/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:i,length:[14],cvcLength:[3],luhn:!0},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:i,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"maestro",pattern:/^(5018|5020|5038|6304|6703|6759|676[1-3])/,format:i,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:i,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"visaelectron",pattern:/^4(026|17500|405|508|844|91[37])/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"visa",pattern:/^4/,format:i,length:[13,16],cvcLength:[3],luhn:!0},{type:"elo",pattern:/^4011|438935|45(1416|76)|50(4175|6699|67|90[4-7])|63(6297|6368)/,format:i,length:[16],cvcLength:[3],luhn:!0}],f=function(a){var b,c,d;for(a=(a+"").replace(/\D/g,""),c=0,d=h.length;c<d;c++)if(b=h[c],b.pattern.test(a))return b},g=function(a){var b,c,d;for(c=0,d=h.length;c<d;c++)if(b=h[c],b.type===a)return b},r=function(a){var b,c,d,e,f,g;for(f=!0,g=0,c=(a+"").split("").reverse(),d=0,e=c.length;d<e;d++)b=c[d],b=parseInt(b,10),(f=!f)&&(b*=2),b>9&&(b-=9),g+=b;return g%10===0},q=function(a){var b;return null!=a.selectionStart&&a.selectionStart!==a.selectionEnd||!(null==("undefined"!=typeof document&&null!==document&&null!=(b=document.selection)?b.createRange:void 0)||!document.selection.createRange().text)},s=function(a){return setTimeout(function(b){return function(){var b,c;return b=a.target,c=e.val(b),c=d.fns.formatCardNumber(c),e.val(b,c)}}(this))},l=function(a){var b,c,d,g,h,i,j;if(c=String.fromCharCode(a.which),/^\d+$/.test(c)&&(h=a.target,j=e.val(h),b=f(j+c),d=(j.replace(/\D/g,"")+c).length,i=16,b&&(i=b.length[b.length.length-1]),!(d>=i||null!=h.selectionStart&&h.selectionStart!==j.length)))return g=b&&"amex"===b.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,g.test(j)?(a.preventDefault(),e.val(h,j+" "+c)):g.test(j+c)?(a.preventDefault(),e.val(h,j+c+" ")):void 0},j=function(a){var b,c;if(b=a.target,c=e.val(b),!a.meta&&8===a.which&&(null==b.selectionStart||b.selectionStart===c.length))return/\d\s$/.test(c)?(a.preventDefault(),e.val(b,c.replace(/\d\s$/,""))):/\s\d?$/.test(c)?(a.preventDefault(),e.val(b,c.replace(/\s\d?$/,""))):void 0},m=function(a){var b,c,d;if(b=String.fromCharCode(a.which),/^\d+$/.test(b))return c=a.target,d=e.val(c)+b,/^\d$/.test(d)&&"0"!==d&&"1"!==d?(a.preventDefault(),e.val(c,"0"+d+" / ")):/^\d\d$/.test(d)?(a.preventDefault(),e.val(c,d+" / ")):void 0},p=function(a){var b,c,d;if(b=String.fromCharCode(a.which),/^\d+$/.test(b))return c=a.target,d=e.val(c)+b,/^\d$/.test(d)&&"0"!==d&&"1"!==d?(a.preventDefault(),e.val(c,"0"+d)):/^\d\d$/.test(d)?(a.preventDefault(),e.val(c,""+d)):void 0},n=function(a){var b,c,d;if(b=String.fromCharCode(a.which),/^\d+$/.test(b))return c=a.target,d=e.val(c),/^\d\d$/.test(d)?e.val(c,d+" / "):void 0},o=function(a){var b,c,d;if(b=String.fromCharCode(a.which),"/"===b)return c=a.target,d=e.val(c),/^\d$/.test(d)&&"0"!==d?e.val(c,"0"+d+" / "):void 0},k=function(a){var b,c;if(!a.metaKey&&(b=a.target,c=e.val(b),8===a.which&&(null==b.selectionStart||b.selectionStart===c.length)))return/\d(\s|\/)+$/.test(c)?(a.preventDefault(),e.val(b,c.replace(/\d(\s|\/)*$/,""))):/\s\/\s?\d?$/.test(c)?(a.preventDefault(),e.val(b,c.replace(/\s\/\s?\d?$/,""))):void 0},y=function(a){var b;return!(!a.metaKey&&!a.ctrlKey)||(32===a.which?a.preventDefault():0===a.which||(a.which<33||(b=String.fromCharCode(a.which),/[\d\s]/.test(b)?void 0:a.preventDefault())))},u=function(a){var b,c,d,g;if(d=a.target,c=String.fromCharCode(a.which),/^\d+$/.test(c)&&!q(d))if(g=(e.val(d)+c).replace(/\D/g,""),b=f(g)){if(!(g.length<=b.length[b.length.length-1]))return a.preventDefault()}else if(!(g.length<=16))return a.preventDefault()},w=function(a,b){var c,d,f;if(d=a.target,c=String.fromCharCode(a.which),/^\d+$/.test(c)&&!q(d))return f=e.val(d)+c,f=f.replace(/\D/g,""),f.length>b?a.preventDefault():void 0},v=function(a){return w(a,6)},x=function(a){return w(a,2)},z=function(a){return w(a,4)},t=function(a){var b,c,d;if(c=a.target,b=String.fromCharCode(a.which),/^\d+$/.test(b)&&!q(c))return d=e.val(c)+b,d.length<=4?void 0:a.preventDefault()},A=function(a){var b,c,f,g,i;if(g=a.target,i=e.val(g),f=d.fns.cardType(i)||"unknown",!e.hasClass(g,f))return b=function(){var a,b,d;for(d=[],a=0,b=h.length;a<b;a++)c=h[a],d.push(c.type);return d}(),e.removeClass(g,"unknown"),e.removeClass(g,b.join(" ")),e.addClass(g,f),e.toggleClass(g,"identified","unknown"!==f),e.trigger(g,"payment.cardType",f)},d=function(){function a(){}return a.fns={cardExpiryVal:function(a){var b,c,d,e;return a=a.replace(/\s/g,""),d=a.split("/",2),b=d[0],e=d[1],2===(null!=e?e.length:void 0)&&/^\d+$/.test(e)&&(c=(new Date).getFullYear(),c=c.toString().slice(0,2),e=c+e),b=parseInt(b,10),e=parseInt(e,10),{month:b,year:e}},validateCardNumber:function(a){var b,c;return a=(a+"").replace(/\s+|-/g,""),!!/^\d+$/.test(a)&&(b=f(a),!!b&&(c=a.length,B.call(b.length,c)>=0&&(b.luhn===!1||r(a))))},validateCardExpiry:function(a,b){var c,d,f,g;return"object"==typeof a&&"month"in a&&(g=a,a=g.month,b=g.year),!(!a||!b)&&(a=e.trim(a),b=e.trim(b),!!/^\d+$/.test(a)&&(!!/^\d+$/.test(b)&&(parseInt(a,10)<=12&&(2===b.length&&(f=(new Date).getFullYear(),f=f.toString().slice(0,2),b=f+b),d=new Date(b,a),c=new Date,d.setMonth(d.getMonth()-1),d.setMonth(d.getMonth()+1,1),d>c))))},validateCardCVC:function(a,b){var c,d;return a=e.trim(a),!!/^\d+$/.test(a)&&(b&&g(b)?(c=a.length,B.call(null!=(d=g(b))?d.cvcLength:void 0,c)>=0):a.length>=3&&a.length<=4)},cardType:function(a){var b;return a?(null!=(b=f(a))?b.type:void 0)||null:null},formatCardNumber:function(a){var b,c,d,e;return(b=f(a))?(e=b.length[b.length.length-1],a=a.replace(/\D/g,""),a=a.slice(0,+e+1||9e9),b.format.global?null!=(d=a.match(b.format))?d.join(" "):void 0:(c=b.format.exec(a),null!=c&&c.shift(),null!=c?c.join(" "):void 0)):a}},a.restrictNumeric=function(a){return e.on(a,"keypress",y)},a.cardExpiryVal=function(b){return a.fns.cardExpiryVal(e.val(b))},a.formatCardCVC=function(b){return a.restrictNumeric(b),e.on(b,"keypress",t),b},a.formatCardExpiry=function(b){var c,d;return a.restrictNumeric(b),b.length&&2===b.length?(c=b[0],d=b[1],this.formatCardExpiryMultiple(c,d)):(e.on(b,"keypress",v),e.on(b,"keypress",m),e.on(b,"keypress",o),e.on(b,"keypress",n),e.on(b,"keydown",k)),b},a.formatCardExpiryMultiple=function(a,b){return e.on(a,"keypress",x),e.on(a,"keypress",p),e.on(b,"keypress",z)},a.formatCardNumber=function(b){return a.restrictNumeric(b),e.on(b,"keypress",u),e.on(b,"keypress",l),e.on(b,"keydown",j),e.on(b,"keyup",A),e.on(b,"paste",s),b},a.getCardArray=function(){return h},a.setCardArray=function(a){return h=a,!0},a.addToCardArray=function(a){return h.push(a)},a.removeFromCardArray=function(a){var b,c;for(b in h)c=h[b],c.type===a&&h.splice(b,1);return!0},a}(),b.exports=d,c.Payment=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"qj/src/qj.coffee":1}]},{},[2])(2)}),function(a,b,c,d){function e(b,c){this.element=b,this.options=a.extend({},f,c),this._defaults=f,this._name="minnpost_giving",this.init()}var f={debug:!1,tabs:!0,stripe_publishable_key:"",plaid_env:"",plaid_public_key:"",plaid_link:"#authorize-ach",minnpost_root:"https://www.minnpost.com",donate_form_selector:"#donate",review_step_selector:"#panel--review",attendees_step_selector:"#panel--attendees",donate_step_selector:"#panel--pay",confirm_form_selector:"#confirm",confirm_step_selector:"#panel--confirmation",active:"panel--review",confirm:"panel--confirmation",query:"step",percentage:.029,fixed_amount:.3,pay_cc_processing_selector:'input[id="edit-pay-fees"]',level_amount_selector:"#panel--review .amount .level-amount",original_amount_selector:"#amount",frequency_selector:".frequency",full_amount_selector:".full-amount",level_indicator_selector:"h2.level",level_name_selector:".level-name",review_benefits_selector:".review-benefits",allow_upsell:!0,upsell_btn_selector:".btn--upsell",upsell_selector:".well--upsell",upsell_amount_selector:".upsell-amount",swag_selector:".swag",separate_swag_selector:"fieldset.swag--separate",separate_swag_redeem:".swag-redeem--separate",atlantic_status:'input[name="swag_atlanticsubscription"]',atlantic_existing:"#atlantic_existing",atlantic_selector:".form-item--atlantic_id",name_selector:".form-item--display-name",honor_selector:".honor",notify_selector:".notify_someone",notify_field_selector:".form-item--notify",anonymous_selector:"#edit-anonymous",show_billing_country_selector:"#billing_show_country",billing_country_selector:".form-item--country",show_shipping_country_selector:"#shipping_show_country",shipping_country_selector:".form-item--shipping-country",shipping_address_selector:".form-item--shipping-address",use_for_shipping_selector:"#useforshipping",email_field_selector:"#edit-email",password_field_selector:"#password",first_name_field_selector:"#first_name",last_name_field_selector:"#last_name",account_city_selector:"#billing_city",account_state_selector:"#billing_state",account_zip_selector:"#billing_zip",create_mp_selector:"#creatempaccount",password_selector:".form-item--password",calculated_amount_selector:".calculated-amount",quantity_field:"#quantity",quantity_selector:".quantity",item_selector:".purchase-item",single_unit_price_attribute:"unit-price",additional_amount_field:"#additional_donation",additional_amount_selector:".additional_donation",has_additional_text_selector:".has_additional",promo_selector:".form-item--promo-code",use_promocode_selector:"#use-promo-code",promocode_selector:"#promo_code",event_id_selector:"#event",calendar_button_selector:".addeventatc",billing_selector:"fieldset.billing",shipping_selector:"fieldset.shipping",credit_card_fieldset:".payment-method-group",choose_payment:"#choose-payment-method",payment_method_selector:".payment-method",cc_num_selector:"#cc-number",cc_exp_selector:"#cc-exp",cc_cvv_selector:"#cc-cvc",payment_button_selector:"#submit",confirm_button_selector:"#finish",opp_id_selector:"#flask_id",recurring_selector:"#recurring",newsletter_group_selector:'[name="newsletters"]',message_group_selector:'[name="messages"]',reason_field_selector:"#reason_for_supporting",share_reason_selector:"#reason_shareable",confirm_top_selector:".support--post-confirm",existing_newsletter_settings:"",levels:{1:{name:"bronze",max:60},2:{name:"silver",min:60,max:120},3:{name:"gold",min:120,max:240},4:{name:"platinum",min:240}},upsell:{bronze:!0,silver:9,gold:19,platinum:!1}};e.prototype={init:function(b,d){this.options.amount=b!==!0?parseFloat(a(this.options.level_amount_selector,this.element).text()):d,this.options.original_amount=parseInt(a(this.options.original_amount_selector,this.element).val(),10),this.options.frequency=parseFloat(a(this.options.frequency_selector,this.element).attr("data-year-freq"));var e=a(this.options.recurring_selector,this.element).val();void 0!==e&&(this.options.recurring=e.charAt(0).toUpperCase()+e.slice(1)),this.options.processing_percent=parseFloat(this.options.percentage),this.options.fixed_fee=parseFloat(this.options.fixed_amount),this.options.new_amount=(this.options.original_amount+this.options.fixed_fee)/(1-this.options.processing_percent),this.options.processing_fee=this.options.new_amount-this.options.original_amount,this.options.processing_fee=(Math.round(parseFloat(this.options.processing_fee)*Math.pow(10,2))/Math.pow(10,2)).toFixed(2),this.options.processing_fee_text=this.options.processing_fee,this.options.upsell_amount=parseFloat(a(this.options.upsell_amount_selector,this.element).text()),this.options.upsold=this.options.amount+this.options.upsell_amount,this.options.cardType=null,this.options.create_account=!1;var f=a("button.give, input.give").text();this.options.button_text=f,Stripe.setPublishableKey(this.options.stripe_publishable_key),""!==c.referrer&&a("#edit_url").prop("href",c.referrer),this.options.debug===!0&&this.debug(this.options);var g=this.qs[this.options.query];void 0===g&&(g=this.options.active),this.paymentPanels(g),a(this.options.pay_cc_processing_selector).length>0&&(this.creditCardProcessingFees(this.options,b),a(this.options.review_step_selector).prepend('<input type="hidden" id="edit-pay-fees" name="pay_fees" value="0" />')),a(this.options.review_step_selector).length>0&&(this.options.level=this.checkLevel(this.element,this.options,"name"),this.options.levelnum=this.checkLevel(this.element,this.options,"num"),this.honorOrMemory(this.element,this.options),this.swag(this.element,this.options,!1),this.upsell(this.element,this.options,this.options.amount,this.options.frequency)),a(this.options.donate_step_selector).length>0&&(this.donateAnonymously(this.element,this.options),this.outsideUnitedStates(this.element,this.options),this.shippingAddress(this.element,this.options),this.allowMinnpostAccount(this.element,this.options,!1),this.creditCardFields(this.element,this.options),this.achFields(this.element,this.options),this.validateAndSubmit(this.element,this.options)),a(this.options.calculated_amount_selector).length>0&&this.calculateAmount(this.element,this.options,""),a(this.options.use_promocode_selector).length>0&&this.usePromoCode(this.element,this.options),a(this.options.calendar_button_selector).length>0&&this.addToCalendar(this.element,this.options),a(this.options.confirm_step_selector).length>0&&(this.showNewsletterSettings(this.element,this.options),this.confirmMessageSubmit(this.element,this.options))},qs:function(a){if(""===a)return{};for(var b={},c=0;c<a.length;++c){var d=a[c].split("=",2);1===d.length?b[d[0]]="":b[d[0]]=decodeURIComponent(d[1].replace(/\+/g," "))}return b}(b.location.search.substr(1).split("&")),debug:function(a){this.options.debug===!0&&("object"!=typeof a?console.log(a):console.dir(a),console.dir(this))},getQueryStrings:function(a){if(void 0===a||""===a)return{};a="?"+a.split("?")[1],a=a.substr(1).split("&");for(var b={},c=0;c<a.length;++c){var d=a[c].split("=",2);1===d.length?b[d[0]]="":b[d[0]]=decodeURIComponent(d[1].replace(/\+/g," "))}return b},paymentPanels:function(b){var d=this,e=this.options.tabs,f="MinnPost | Support Us | ",g=a(".progress--donation li."+b).text(),h=(a(".progress--donation li."+b).next().text(),a(".progress--donation li."+b).index()+1),i=a(".progress--donation li").length;a(this.options.opp_id_selector).val();a(this.options.confirm_step_selector).length>0&&(b=this.options.confirm,a(".progress--donation li."+b+" span").addClass("active"),h=a(".progress--donation li."+b).index()+1,a(this.options.confirm_button_selector).length>0&&(i+=1)),h===i-1&&a(this.options.opp_id_selector).length>0?h="purchase":h===i&&a(this.options.opp_id_selector).length>0?h="purchase":h===i&&a(this.options.opp_id_selector).length,c.title=f+g,this.analyticsTrackingStep(h,f),e===!0?a(".panel").hide():a(".panel").show(),0===a(".progress--donation li .active").length?(a("#"+b).fadeIn(),a(".progress--donation li."+b+" a").addClass("active")):(b=a(".progress--donation li .active").parent().prop("class"),a("#"+b).fadeIn()),a(".progress--donation li a, a.btn.btn--next").click(function(b){b.preventDefault(),a(".progress--donation li a").removeClass("active");var c=a(this).prop("href"),e=d.getQueryStrings(c);e=e.step,a(".progress--donation li."+e+" a").addClass("active"),d.paymentPanels(e)})},analyticsTrackingStep:function(c,d){var e=this.checkLevel(this.element,this.options,"name"),f=(this.checkLevel(this.element,this.options,"num"),a(this.options.original_amount_selector).val()),g=this.options.recurring,h=a(this.options.opp_id_selector).val();ga("ec:addProduct",{id:"minnpost_"+e.toLowerCase()+"_membership",name:"MinnPost "+e.charAt(0).toUpperCase()+e.slice(1)+" Membership",category:"Donation",brand:"MinnPost",variant:g,price:f,quantity:1}),"purchase"===c?ga("ec:setAction","purchase",{id:h,affiliation:"MinnPost",revenue:f}):ga("ec:setAction","checkout",{step:c}),ga("set",{page:b.location.pathname,title:d}),ga("send","pageview",b.location.pathname)},creditCardProcessingFees:function(b,c){var d,e=this,f=!1;a(this.options.pay_cc_processing_selector).parent().html('<a href="#" class="add-credit-card-processing">Add $<span class="processing-amount"></span></a> <span class="processing-explain">to each transaction to cover MinnPost\'s credit card fees?</span>'),a(".processing-amount").text(b.processing_fee_text),this.options.original_amount!=this.options.amount&&(a(".add-credit-card-processing").text("Remove $"+b.processing_fee_text),a("#edit-pay-fees").val(1),f=!0,a(".processing-explain").hide()),c===!0&&(f=!1,d=e.options.original_amount,a(".add-credit-card-processing").text("Add $"+e.options.processing_fee_text),a("#edit-pay-fees").val(0),a(".processing-explain").show()),a(".add-credit-card-processing").click(function(c){a(".amount .level-amount").addClass("full-amount"),f?(f=!1,d=e.options.original_amount,a(".add-credit-card-processing").text("Add $"+b.processing_fee_text),a("#edit-pay-fees").val(0),a(".processing-explain").show()):(f=!0,d=e.options.new_amount,a(".add-credit-card-processing").text("Remove $"+b.processing_fee_text),a("#edit-pay-fees").val(1),a(".processing-explain").hide()),a(".add-credit-card-processing").toggleClass("remove"),a(b.full_amount_selector).text(parseFloat(d).toFixed(2)),c.stopPropagation(),c.preventDefault()})},donateAnonymously:function(b,c){a(c.anonymous_selector,b).is(":checked")?a(c.name_selector+" div:first",b).hide():a(c.name_selector+" div:first",b).show(),a(c.anonymous_selector,b).change(function(){a(this).is(":checked")?a(c.name_selector+" div:first",b).hide():a(c.name_selector+" div:first",b).show()})},checkLevel:function(b,c,d){var e,f="",g=0,h="level level--",i=c.frequency,j=c.original_amount;if(12===i?e=j*i:1===i&&(e=j),a.each(c.levels,function(a,b){var c=b.name,d=a,i=b.max,j=b.min;if(void 0!==j&&void 0!==i){if(e>=j&&e<i)return f=c,g=d,h+=d,!1}else if(void 0!==i){if(e<i)return f=c,g=d,h+=d,!1}else if(void 0!==j&&e>=j)return f=c,g=d,h+=d,!1}),a(c.level_indicator_selector).length>0&&a(c.review_benefits_selector).length>0){a(c.level_indicator_selector,b).prop("class",h),a(c.level_name_selector).text(f.charAt(0).toUpperCase()+f.slice(1));var k=this.getQueryStrings(a(c.review_benefits_selector,b).prop("href"));k=k.level;var l=a(c.review_benefits_selector,b).prop("href");l=l.replace(k,f),a(c.review_benefits_selector).prop("href",l)}return"name"===d?f:"num"===d?g:void 0},upsell:function(b,c,d,e){if(c.allow_upsell===!0){var f,g=this;12===e?f=d:1===e&&(f=d/e),a.each(c.upsell,function(d,e){d===c.level&&(e!==!0&&f<e||e===!1)&&a(c.upsell_selector,b).hide()}),a(c.upsell_btn_selector,b).click(function(d){var e=c.upsold;g.options.amount=e,a(c.level_amount_selector,b).text(e),a(c.full_amount_selector,b).text(e),a(c.original_amount_selector,b).val(e),a(this).remove(),d.stopPropagation(),d.preventDefault(),g.init(!0,e)})}else a(c.upsell_selector,b).hide()},honorOrMemory:function(b,d){a(d.honor_selector+" fieldset").prepend('<a href="#" class="close">Close</a>'),a(d.honor_selector+" p a",b).click(function(){return a("fieldset."+a(this).prop("class"),b).addClass("visible").show(),!1}),a(d.honor_selector+" fieldset a.close",b).click(function(){return a("fieldset."+a(this).parent().prop("class").substring(0,a(this).parent().prop("class").length-8),b).removeClass("visible").hide(),!1}),a(c).keyup(function(c){27===c.keyCode&&a("fieldset.visible",b).removeClass("visible").hide()}),a(d.notify_selector,b).is(":checked")?a(d.notify_field_selector,b).show():a(d.notify_field_selector,b).hide(),a(d.notify_selector,b).change(function(){a(this).is(":checked")?a(d.notify_field_selector,b).show():a(d.notify_field_selector,b).hide()})},swag:function(b,c,d){var e=this,f=e.options.levelnum;d===!1&&(a(c.swag_selector,b).hide(),a(c.swag_selector,b).filter(function(b){return a(this).prop("class").slice(-1)<=f}).show(),a(c.separate_swag_redeem,b).click(function(d){return d.stopImmediatePropagation(),a(c.separate_swag_selector,b).toggle(),!1})),a(c.atlantic_existing,b).is(":checked")?a(c.atlantic_selector,b).show():a(c.atlantic_selector,b).hide(),a(c.atlantic_status,b).change(function(){e.swag(b,c,!0)})},outsideUnitedStates:function(b,c){a(c.show_billing_country_selector).click(function(){return a(c.billing_country_selector).show(),a(this).parent().hide(),!1}),a(c.show_shipping_country_selector).click(function(){return a(c.shipping_country_selector).show(),a(this).parent().hide(),!1})},shippingAddress:function(b,c){var d=this,e=!1;a(c.use_for_shipping_selector).length>0&&(e=!0),e===!0&&(a(c.use_for_shipping_selector,b).parent().show(),a(c.use_for_shipping_selector,b).is(":checked")?a(c.shipping_selector).hide():a(c.shipping_selector).show(),a(c.use_for_shipping_selector,b).change(function(){d.shippingAddress(b,c)}))},allowMinnpostAccount:function(b,c,d){function e(){var d=a(c.email_field_selector,b).val();h=g.checkMinnpostAccountExists(b,c,d)}var f,g=this,h=!1;a(c.email_field_selector,b).keyup(function(){clearTimeout(f),a(c.email_field_selector,b).val&&(f=setTimeout(e,5e3))}),a(c.create_mp_selector,b).is(":checked")?(a(c.password_selector,b).show(),c.create_account=!0):a(c.password_selector,b).hide(),a(c.create_mp_selector,b).change(function(){g.allowMinnpostAccount(b,c,!0)}),d===!1&&(a(c.password_selector,b).append('<div class="help-link"><span>Password help</span></div><div class="form-help">Password must be at least 6 characters.</div><label class="additional-option"><input type="checkbox" name="showpassword" id="showpassword"> Show password</label>'),a(c.create_mp_selector,b).parent().before('<p class="account-exists success">There is already a MinnPost.com account with this email.</p>'),a(".account-exists").hide(),a("#showpassword").click(function(){a(this).is(":checked")?a("#password").get(0).type="text":a("#password").get(0).type="password"}),a(".form-item .form-help").hide()),a(".form-item--with-help label, .form-item--with-help input").next(".help-link").click(function(){return a(this).next(".form-help").toggle(),!1})},populateAttendees:function(b){var c="",d=a(".attendees > fieldset:first").html();for(i=1;i<=b;i++)c+='<fieldset class="attendee">'+d.replace(/_1/g,"_"+i)+"</fieldset>";a(".attendees").html(c)},displayAmount:function(b,c,d,e,f,g){var h=d*parseInt(e,10);""===f?(f=0,a(c.create_mp_selector).parent().hide()):(h+=parseInt(f,10),levelcheck={original_amount:f,frequency:1,levels:c.levels},level=this.checkLevel(b,levelcheck,"num"),level>=2&&a(c.create_mp_selector).parent().show(),a(c.has_additional_text_selector).html(a(c.has_additional_text_selector).data("text")),a(c.additional_amount_selector).text(parseFloat(a(c.additional_amount_field).val()))),a(c.calculated_amount_selector).text(h),a(c.original_amount_selector).val(e*d),a(c.quantity_selector).text(e),1==e?a(".attendee-title").text(a(".attendee-title").data("single")):a(".attendee-title").text(a(".attendee-title").data("plural")),a(".code-result").remove(),g===!0?(a(".apply-promo-code").after('<p class="code-result success">Your member discount code was successfully added.</p>'),a(".show-"+c.single_unit_price_attribute).text(d),a(".apply-promo-code").text("Applied").addClass("btn--disabled")):g===!1&&a(".apply-promo-code").after('<p class="code-result error">This code is incorrect. Try again.</p>')},calculateAmount:function(b,c,d){var e=this,f=a(c.quantity_field).val(),g=a(c.quantity_field).data(c.single_unit_price_attribute),h=a(c.additional_amount_field).val();d.success===!0&&(g=d.single_unit_price),e.displayAmount(b,c,g,f,h,d.success),a(c.quantity_field+", "+c.additional_amount_field).change(function(){f=a(c.quantity_field).val(),h=a(c.additional_amount_field).val(),1!=f?a(c.item_selector).text(a(c.item_selector).data("plural")):a(c.item_selector).text(a(c.item_selector).data("single")),e.displayAmount(b,c,g,f,h)});var i="";a(c.review_step_selector).find(".btn").click(function(){i=e.populateAttendees(f)}),a(".progress--donation .panel--attendees").find("a").click(function(){i=e.populateAttendees(f)}),a(this.options.promocode_selector).length>0&&a(".apply-promo-code").click(function(d){var f=a(c.promocode_selector,b).val();if(a(c.event_id_selector).length>0)var g=a(c.event_id_selector,b).val();else var g=1;d.preventDefault();var h={promo_code:f,event:g};a.ajax({method:"POST",url:"/event-check-promo/",data:h}).done(function(a){e.calculateAmount(b,c,a)})})},checkPromoCode:function(b){var c={promo_code:b};a.ajax({method:"POST",url:"/event-check-promo/",data:c}).done(function(a){return a.success===!0})},usePromoCode:function(b,c){a(this.options.use_promocode_selector).parent().html('<a href="#" class="use-promo-code">Use promo code</a>'),""===a(this.options.promocode_selector).val()?a(c.promo_selector+" div:first",b).hide():a(c.promo_selector+" div:last",b).hide(),a(".use-promo-code").click(function(d){a(c.promo_selector+" div:first",b).show(),a(c.promo_selector+" div:last",b).hide(),d.preventDefault()})},addToCalendar:function(b,c){a(c.calendar_button_selector).css("display","inline-block")},checkMinnpostAccountExists:function(b,c,d){var e={email:d};a.ajax({method:"POST",url:c.minnpost_root+"/accounts/exists",data:e}).done(function(d){if("success"!==d.status||"user exists"!==d.reason)return a(c.create_mp_selector,b).is(":checked")?(a(c.password_selector,b).show(),c.create_account=!0):a(c.password_selector,b).hide(),a(".account-exists",b).hide(),!1;a(c.create_mp_selector,b).is(":checked")&&(a(c.password_selector,b).hide(),a(c.create_mp_selector,b).parent().hide(),a(".account-exists",b).show()),a(c.create_mp_selector,b).on("change",function(){a(c.create_mp_selector,b).is(":checked")&&(a(c.password_selector,b).hide(),a(c.create_mp_selector,b).parent().hide(),a(".account-exists",b).show())})})},creditCardFields:function(b,c){if(a(c.choose_payment).length>0){if(a(c.choose_payment+" input").is(":checked")){var d=a(c.choose_payment+" input:checked").attr("id");a(c.payment_method_selector).removeClass("active"),a(c.payment_method_selector+"."+d).addClass("active"),a(c.payment_method_selector+":not(.active) label").removeClass("required"),a(c.payment_method_selector+":not(.active) input").prop("required",!1),a(c.payment_method_selector+".active label").addClass("required"),a(c.payment_method_selector+".active input").prop("required",!0)}a(c.choose_payment+" input").change(function(b){a(c.payment_method_selector).removeClass("active"),a(c.payment_method_selector+"."+this.id).addClass("active"),a(c.payment_method_selector+":not(.active) label").removeClass("required"),a(c.payment_method_selector+":not(.active) input").prop("required",!1),a(c.payment_method_selector+".active label").addClass("required"),a(c.payment_method_selector+".active input").prop("required",!0),a("#bankToken").remove()})}"undefined"!=typeof Payment&&(Payment.formatCardNumber(a(c.cc_num_selector,b)),Payment.formatCardExpiry(a(c.cc_exp_selector,b)),Payment.formatCardCVC(a(c.cc_cvv_selector,b)),a(c.cc_num_selector,b).parent().prepend('<span class="card-image"></span>'),a(c.cc_num_selector,b).keyup(function(){c.cardType=Payment.fns.cardType(a(c.cc_num_selector,b).val()),a(".card-image").prop("class","card-image "+a("#cc-number").prop("class"))}))},achFields:function(b,c){if(""!=c.plaid_env&&""!=c.key&&"undefined"!=typeof Plaid){var d=Plaid.create({selectAccount:!0,env:c.plaid_env,clientName:"MinnPost",key:c.plaid_public_key,product:"auth",onLoad:function(){},onSuccess:function(d,e){var f=a(c.donate_form_selector);f.append(a('<input type="hidden" name="public_token" />').val(d)),f.append(a('<input type="hidden" name="account_id" />').val(e.account_id)),a.ajax({url:"/plaid_token/",cache:!1,data:a(f).serialize(),type:"POST"}).done(function(d){void 0!==d.error?a(c.plaid_link).parent().after('<p class="error">'+d.error+"</p>"):(a(c.donate_form_selector).prepend('<input type="hidden" id="bankToken" name="bankToken" value="'+d.stripe_bank_account_token+'" />'),a(c.plaid_link,b).html("<strong>Your account was successfully authorized</strong>").contents().unwrap())}).error(function(b){
a(c.plaid_link).parent().after('<p class="error">'+b.error+"</p>")})},onExit:function(){}});a(c.plaid_link,b).click(function(b){b.preventDefault(),a(c.payment_method_selector+" .error").remove(),d.open()})}},hasHtml5Validation:function(a,b){return"function"==typeof c.createElement("input").checkValidity},buttonStatus:function(a,b,c){b.prop("disabled",c),c===!1?b.text(a.button_text):b.text("Processing")},validateAndSubmit:function(b,d){var e=this;a(this.options.donate_form_selector).prepend('<input type="hidden" id="source" name="source" value="'+c.referrer+'" />'),a(d.donate_form_selector).submit(function(c){c.preventDefault(),e.hasHtml5Validation(b,d)&&(this.checkValidity()?(a(this).removeClass("invalid"),a(this).find("input:invalid").parent().removeClass("error")):(a(this).addClass("invalid"),a("html, body").animate({scrollTop:a(this).find("input:invalid").parent().offset().top},2e3),a(this).find("input:invalid").parent().addClass("error"))),a(".check-field, .card-instruction").remove(),a("input, label",b).removeClass("error");var f=!0,g="card";if(a(d.choose_payment).length>0&&(g=a(d.choose_payment+" input:checked").val()),a(d.choose_payment+" input").change(function(){a(d.payment_method_selector+" .error").remove()}),"undefined"!=typeof Payment&&"ach"!==g){var h=Payment.fns.cardExpiryVal(a(d.cc_exp_selector,b).val()),i=Payment.fns.validateCardNumber(a(d.cc_num_selector,b).val()),j=Payment.fns.validateCardExpiry(h.month,h.year),k=Payment.fns.validateCardCVC(a(d.cc_cvv_selector,b).val(),d.cardType);i===!1||j===!1||k===!1?(f=!1,a(d.cc_num_selector,b).parent().addClass("error"),i===!1?a(d.cc_num_selector,b).addClass("error"):(a(d.cc_exp_selector,b).removeClass("error"),a(d.cc_cvv_selector,b).removeClass("error")),j===!1?a(d.cc_exp_selector,b).addClass("error"):(a(d.cc_num_selector,b).removeClass("error"),a(d.cc_cvv_selector,b).removeClass("error")),k===!1?a(d.cc_cvv_selector,b).addClass("error"):(a(d.cc_num_selector,b).removeClass("error"),a(d.cc_exp_selector,b).removeClass("error"))):(a(d.cc_num_selector,b).parent().removeClass("error"),a(d.cc_num_selector,b).removeClass("error"),a(d.cc_exp_selector,b).removeClass("error"),a(d.cc_cvv_selector,b).removeClass("error"))}else"ach"===g&&0===a('input[name="bankToken"]').length&&(f=!1,a(d.payment_method_selector).prepend('<p class="error">You are required to enter credit card information, or to authorize MinnPost to charge your bank account, to make a payment.</p>'));var l=a(d.donate_form_selector);if(f===!0){e.buttonStatus(d,l.find("button"),!0);var m=function(c,f){e.debug("trying to get stripe response");var g=a(d.donate_form_selector);if(f.errors)e.buttonStatus(d,g.find("button"),!1);else{if(0===a('input[name="bankToken"]').length){var h=f.id;a('input[name="stripeToken"]').length>0?a('input[name="stripeToken"]').val(h):g.append(a('<input type="hidden" name="stripeToken" />').val(h))}else e.debug("we have a bank token");a.ajax({url:"/charge_ajax/",cache:!1,data:a(g).serialize(),type:"POST"}).done(function(c){if(void 0!==c.errors){if(e.buttonStatus(d,g.find("button"),!1),a.each(c.errors,function(c,e){var f=e.field+"_field_selector",g="";g="string"==typeof e.message?e.message:e.message[0],a(f).length>0&&(a(d[f],b).addClass("error"),a(d[f],b).prev().addClass("error"),a(d[f],b).after('<span class="check-field invalid">'+g+"</span>")),"csrf_token"==e.field&&a("button.give").before('<p class="error">Sorry, this form had a back-end error and was unable to complete your donation. Please <a href="#" onclick="location.reload(); return false;">reload the page</a> and try again (we will preserve as much of your information as possible).</p>')}),void 0!==c.errors.error&&("invalid_number"!=c.errors.error.code&&"incorrect_number"!=c.errors.error.code&&"card_declined"!=c.errors.error.code&&"processing_error"!=c.errors.error.code||(a(d.cc_num_selector,b).addClass("error"),a(d.cc_num_selector,b).prev().addClass("error"),a(d.cc_num_selector,b).after('<span class="card-instruction invalid">'+c.errors.error.message+"</span>")),"invalid_expiry_month"!=c.errors.error.code&&"invalid_expiry_year"!=c.errors.error.code&&"expired_card"!=c.errors.error.code||(a(d.cc_exp_selector,b).addClass("error"),a(d.cc_exp_selector,b).prev().addClass("error"),a(d.cc_num_selector,b).after('<span class="card-instruction invalid">'+c.errors.error.message+"</span>")),"invalid_cvc"!=c.errors.error.code&&"incorrect_cvc"!=c.errors.error.code||(a(d.cc_cvv_selector,b).addClass("error"),a(d.cc_cvv_selector,b).prev().addClass("error"),a(d.cc_num_selector,b).after('<span class="card-instruction invalid">'+c.errors.error.message+"</span>")),"invalid_request_error"==c.errors.error.type&&a("button.give").before('<p class="error">'+c.errors.error.message+"</p>")),void 0!==c.errors[0]){var f=c.errors[0].field+"_field_selector";a(f).length>0&&a("html, body").animate({scrollTop:a(d[f],b).parent().offset().top},2e3)}}else g.get(0).submit()}).error(function(a){e.buttonStatus(d,g.find("button"),!1)}),e.buttonStatus(d,g.find("button"),!0)}},n="";n=a("#full_name").length>0?a("#full_name").val():a("#first_name").val()+" "+a("#last_name").val();var o="None";""!=a('input[name="full_address"]').val()&&(o=a("#full_address").val(),""!=a('input[name="billing_street"]').val()&&(o=a('input[name="billing_street"]').val()));var p="None";""!=a('input[name="billing_city"]').val()&&(p=a('input[name="billing_city"]').val());var q="None";""!=a('input[name="billing_state"]').val()&&(q=a('input[name="billing_state"]').val());var r="None";""!=a('input[name="billing_zip"]').val()&&(r=a('input[name="billing_zip"]').val());var s="US";if(""!=a('input[name="billing_country"]').val()&&(s=a('input[name="billing_country"]').val()),d.create_account===!0){var t={email:a(d.email_field_selector,b).val(),first:a(d.first_name_field_selector,b).val(),last:a(d.last_name_field_selector,b).val(),password:a(d.password_field_selector,b).val(),city:a(d.account_city_selector,b).val(),state:a(d.account_state_selector,b).val(),zip:a(d.account_zip_selector,b).val()};a.ajax({method:"POST",url:d.minnpost_root+"/accounts/create",data:t}).done(function(a){"success"===a.status&&a.reason})}if(0==a('input[name="bankToken"]').length)Stripe.card.createToken({number:a(d.cc_num_selector).val(),cvc:a(d.cc_cvv_selector).val(),exp:a(d.cc_exp_selector).val(),name:n,address_line1:o,address_city:p,address_state:q,address_zip:r,address_country:s},m);else{m("success",a("#bankToken").val())}}else e.buttonStatus(d,l.find("button"),!1)})},showNewsletterSettings:function(b,c){if(a(c.newsletter_group_selector).length>0&&void 0!==a(c.email_field_selector,b).val()){var d={email:a(c.email_field_selector,b).val()};a.ajax({method:"POST",url:c.minnpost_root+"/mailchimp/minnpost/groups",data:d}).done(function(b){if("success"===b.status&&"user exists"===b.reason){a(".confirm-instructions").text(a(".confirm-instructions").attr("data-known-user"));var c=b.groups,d=b.additional;a.each(c,function(b,c){a(':checkbox[value="'+c+'"]').prop("checked","true")}),a.each(d,function(b,c){a(':checkbox[value="'+c+'"]').prop("checked","true")})}})}},confirmMessageSubmit:function(b,c){var d=a(".support-newsletter :input").serialize();a(c.confirm_form_selector).submit(function(e){e.preventDefault();var f=a(c.confirm_form_selector),g=a(c.newsletter_group_selector+":checked"),h=a(c.message_group_selector+":checked");if(d===a(".support-newsletter :input:checked").serialize()||void 0===g&&void 0===h)f.get(0).submit();else{var i={minnpost_mailchimp_js_form_action:"newsletter_subscribe",minnpost_mailchimp_email:a(c.email_field_selector,b).val(),minnpost_mailchimp_firstname:a(c.first_name_field_selector,b).val(),minnpost_mailchimp_lastname:a(c.last_name_field_selector,b).val(),minnpost_mailchimp_groups:{},minnpost_mailchimp_periodic:{}};void 0!==g&&a.each(g,function(a,b){i.minnpost_mailchimp_groups[b]=1}),void 0!==h&&a.each(h,function(a,b){i.minnpost_mailchimp_periodic[b]=1}),a.ajax({method:"POST",url:c.minnpost_root+"/mailchimp/minnpost/api",data:i}).done(function(a){a.status,f.get(0).submit()})}})}},a.fn.minnpost_giving=function(b){return this.each(function(){a.data(this,"plugin_minnpost_giving")||a.data(this,"plugin_minnpost_giving",new e(this,b))})}}(jQuery,window,document);